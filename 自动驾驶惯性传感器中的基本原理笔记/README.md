# 自动驾驶惯性传感器中的基本原理笔记

前言：自动驾驶中常用的传感器有：九轴传感器、六轴传感器、查分GPS  RTK、GPS、惯性导航(ins)等，因为在调试机器人过程中，产生一些的坐标系混乱问题，故此将搜集到的资料整理成笔记，用作后续翻阅。部分原理的笔记转载自[IMU模块中的一些基本概念和常见问题](https://zhuanlan.zhihu.com/p/344884686?ivk_sa=1024320u)，部分由个人请教行业专家所得记录。

参考博客：

[IMU模块中的一些基本概念和常见问题](https://zhuanlan.zhihu.com/p/344884686?ivk_sa=1024320u)

说明：以下说法是为了不改变原意的情况下方便快速理解的比较通俗的解释，不是正式定义。

## 1. 术语解释问题

### 1.1 6轴,9轴,IMU,VRU和AHRS分别指的是什么?

6轴9轴的概念很好理解：说白了就是模块上装了哪些，多少传感器

- 6轴 : 三轴(XYZ)加速度计 + 三轴(XYZ)陀螺仪(也叫角速度传感器)
- 9轴 : 6轴 + 三轴(XYZ)磁场传感器
- 6轴模块可以构成**VRU**(垂直参考单元)和IMU(惯性测量单元)，9轴模块可以构成AHRS(航姿参考系统)
- IMU**:** 惯性测量单元，可以输出加速度和角速度。并不输出姿态角等其他信息
- VRU: IMU的基础上内置姿态解算算法，可以输出姿态信息。

静止状态下加速度计可以测得重力矢量并作为参考，所以静态下俯仰横滚角不会漂移而且精度比较高，然而由于航向角与重力垂直，没有绝对参考，水平方向上的航向角误差会随着时间慢慢变大，变的越来越不准 。

当模块运动时，加速度计测量的不仅仅只有重力，还有其他运动加速度(有害加速度)，所以模块运动中是不能用重力矢量作为参考修正俯仰横滚角的。一个简单的结论就是：如果模块长时间处于大机动状态，那么三个欧拉角误差都会随时间变大(越来越不准)，一旦静止，俯仰横滚角会被重新"拉"回到正确的位置，而航向角因为没有参考则不会得到校正。

- AHRS: VRU的基础上修改算法，可以解算被测物体的全姿态，包括绝对的航向角(与地磁北极的夹角)，因为要用到地磁传感器，所以必须是9轴模块。另外室内由于地磁场畸变非常严重，AHRS 在室内也很难获得准确的绝对航向角。
- GPS：美国的全球卫星定位系统：Global Position System翻译过来就叫全球卫星定位系统。也是因为GPS是第一个出来的，老美命名的也比较骄傲，没有考虑后面还有其他国家也做出来卫星定位系统，可以这样理解： GPS是GPS牌GPS，后面还有中国的北斗牌GPS，毛子的格洛纳斯牌GPS等。
- GNSS: 全球卫星定位系统，GPS，北斗，格洛纳斯等系统的总称，每一个系统叫做一个"星座"
- GNSS/INS: 卫星/惯导组合导航系统

以下是正式定义：(不感兴趣可以不看了)

- IMU 惯性测量单元(Inertial Measurement Unit) 是测量物体三轴角速度和加速度的设备。一个IMU内可能会装有三轴陀螺仪和三轴加速度计，来测量物体在三维空间中的角速度和加速度。严格意义上的IMU只为用户提供三轴角速度以及三轴加速度数据。
- VRU 垂直参考单元(Vertical Reference Unit)是在IMU的基础上，以重力向量作为参考，用卡尔曼或者互补滤波等算法为用户提供有重力向量参考的俯仰角、横滚角以及无参考标准的航向角。通常所说的6轴姿态模块就属于这类系统。航向角没有参考，不管模块朝向哪里，启动后航向角都为0°(或一个设定的常数)。随着模块工作时间增加，航向角会缓慢累计误差。俯仰角，横滚角由于有重力向量参考，低机动运动情况下，长时间不会有累积误差。
- AHRS 航姿参考系统(Attitude and Heading Reference System)AHRS系统是在VRU的基础上增加了磁力计或光流传感器，用卡尔曼或者互补滤波等算法为用户提供拥有绝对参考的俯仰角、横滚角以及航向角的设备，这类系统用来为飞行器提供准确可靠的姿态与航行信息。我们通常所说的9轴姿态传感器就属于这类系统，因为航向角有地磁场的参考，所以不会漂移。但地磁场很微弱，经常受到周围带磁物体的干扰，所以如何在高机动情况下抵抗各种磁干扰成为AHRS研究的热门。
- GNSS/INS 这是一种组合导航系统，顾名思义这种系统是利用全球卫星导航系统(Global Navigation Satellite System 简称GNSS，它是GPS，北斗，GLONASS、GALILEO等系统的统称) 与惯性导航(Inertial Navigation System)各自的优势进行算法融合，为用户提供更加精准的姿态及位置信息。

下图是组合导航系统的一个基本的框图，它以加速度计、陀螺仪、磁力计、气压计、GNSS等作为基本输入，利用融合算法输出用户所需要的姿态信息、位置信息以及速度信息。

![zhihu_xiyang](https://kaho-pic-1307106074.cos.ap-guangzhou.myqcloud.com/CSDN_Pictures/%E6%B7%B1%E8%93%9D%E5%A4%9A%E4%BC%A0%E6%84%9F%E5%99%A8%E8%9E%8D%E5%90%88%E5%AE%9A%E4%BD%8D/%E7%AC%AC%E4%BA%8C%E7%AB%A0%E6%BF%80%E5%85%89%E9%87%8C%E7%A8%8B%E8%AE%A11zhihu_xiyang.jpg)

## 2.个人笔记总结

### 2.1 针对9轴、6轴、ins 、RTK 传感器

a. 6轴和9轴输出的是本身传感器的测量数据，accel、gyro 都是基于轴上的线加速度和轴角的角速度变换，都是原始的数值。而9轴相对于6轴只是增加一个磁力计测绝对方向，9轴中的imu传感器本身的测量和6轴一样。

b.问：本科的时候使用消费级的低成本6轴 mpu6050,可以通过调用DMP(运动姿态解算库)的方法，获取四元数、欧拉角，我挺不理解，他既然是6轴传感器，只能获得绝对的 roll、pitch，应该是没办法获取roll才对。

答：6轴使用dmp解算时，roll、pich是ENU系下的，是绝对值，但是yaw和地理航向就没有任何关系了，6轴dmp解算后的yaw是相对于上电校准成功后的角度。9轴是地磁航向，地磁航向和ENU航向之间有个夹角，是已知的，可以补偿。

问："9轴的地磁航向" 和 "ENU的航向" 之间的夹角补偿，是指我们平时说的，在当地进行磁力计校准吗？磁力计校准后，9轴的航向就是ENU系下的是吗？

答：不是，地磁的北极和地理的北极不一致，二者有夹角。"磁力计校准" 校准是计算传感器的测量误差。

c.问：建图时，初始航向可以取自9轴、6轴、ins吗？

答：可以。很多slam建图都没有imu呢，航向就是初始为0和ENU都没有任何关系，不也照样到导航、规划、感知。定位是基于地图的定位，只要相对于地图的位置和姿态是准的就行行了。

d.问：建图时，初始航向设置为0，重定位估计航向使用什么方法？、

答：有的使用手动给航向，有的遍历航向。

e.问：老师，是不是现在自动驾驶的感知、规划方案，多数都是要基于先验高精地图的？

答：是。

​																													edited by  kaho  2022.3.6



